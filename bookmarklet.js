void%20function($){var%20loadBookmarklet=function($){(function(window){function%20getGlobalNamespace(){return%20window%26%26window.INSTALL_SCOPE%3Fwindow.INSTALL_SCOPE:window}function%20now(){return(new%20Date).getTime()}function%20bind(t,e){return%20function(){return%20e.apply(t,arguments)}}function%20each(t,e,s){if(%22function%22==typeof%20t.forEach)return%20t.forEach(e,s),t;for(var%20i%20in%20t)t.hasOwnProperty(i)%26%26e.call(s||window,t[i],i);return%20t}function%20addEvent(t,e,s){t.addEventListener%3Ft.addEventListener(e,s,!1):t.attachEvent%26%26(t[%22e%22+e+s]=s,t[e+s]=function(){return%20t[%22e%22+e+s](window.event)},t.attachEvent(%22on%22+e,t[e+s]))}function%20removeEvent(t,e,s){t.removeEventListener%3Ft.removeEventListener(e,s,!1):t.detachEvent%26%26(t.detachEvent(%22on%22+e,t[e+s]),t[e+s]=null,t[%22e%22+e+s]=null)}function%20stopEvent(t){t.stopPropogation%26%26t.stopPropogation(),t.preventDefault%26%26t.preventDefault(),t.returnValue=!1}function%20elementIsContainedIn(t,e){return%20element.contains%3Ft.contains(e):!!(16%26t.compareDocumentPosition(e))}function%20code(t){var%20e={87:%22up%22,83:%22down%22,65:%22left%22,68:%22right%22,27:%22esc%22};return%20e[t]%3Fe[t]:String.fromCharCode(t)}function%20random(t,e){return%20Math.floor(Math.random()*(e-t+1)+t)}function%20getRect(t){if(%22function%22==typeof%20t.getBoundingClientRect){var%20e=t.getBoundingClientRect(),s=window.pageXOffset,i=window.pageYOffset;return{width:e.width,height:e.height,left:e.left+s,top:e.top+i}}for(var%20e={width:t.offsetWidth,height:t.offsetHeight,left:0,top:0},n=t;n;)e.left+=n.offsetLeft,e.top+=n.offsetTop,n=n.offsetParent;return%20e}function%20getCompatElement(){var%20t=document;return%20t.compatMode%26%26%22CSS1Compat%22!=t.compatMode%3Ft.body:t.documentElement}function%20getScrollSize(){var%20t=getCompatElement(),e={x:t.clientWidth,y:t.clientHeight},s=document.body;return{x:Math.max(t.scrollWidth,s.scrollWidth,e.x),y:Math.max(t.scrollHeight,s.scrollHeight,e.y)}}function%20setStyles(t,e){for(var%20s%20in%20e)if(e.hasOwnProperty(s)){var%20i=e[s];%22number%22==typeof%20i%26%26%22opacity%22!==s%26%26%22zIndex%22!==s%26%26(i+=%22px%22),t.style[s]=i}}function%20hasClass(t,e){return%20t.className.match(new%20RegExp(%22(\\s|^)%22+e+%22(\\s|$)%22))}function%20addClass(t,e){hasClass(t,e)||(t.className+=%22%20%22+e)}function%20removeClass(t,e){if(hasClass(t,e)){var%20s=new%20RegExp(%22(\\s|^)%22+e+%22(\\s|$)%22);t.className=t.className.replace(s,%22%20%22)}}function%20cloneElement(t){return%20t.cloneNode(!0)}function%20newElement(t,e){var%20s=document.createElement(t);for(var%20i%20in%20e)e.hasOwnProperty(i)%26%26(%22styles%22===i%3FsetStyles(s,e[i]):s[i]=e[i]);return%20s}function%20delay(t,e,s){return%20setTimeout(bind(s,e),t)}function%20getAppContainerElement(){return%20namespace.KICKASS_CONTAINER_ELEMENT%3Fdocument.getElementById(namespace.KICKASS_CONTAINER_ELEMENT):document.body}var%20CORS=(function(){function%20t(t){var%20e=document.createElement(%22script%22),i=!1;e.src=t,e.async=!0,e.onload=e.onreadystatechange=function(){i||this.readyState%26%26%22loaded%22!==this.readyState%26%26%22complete%22!==this.readyState||(i=!0,e.onload=e.onreadystatechange=null,e%26%26e.parentNode%26%26e.parentNode.removeChild(e))},s||(s=document.getElementsByTagName(%22head%22)[0],s||(s=document.body)),s.appendChild(e)}function%20e(e,s,h){i=%22%3F%22,s=s||{};for(n%20in%20s)s.hasOwnProperty(n)%26%26(i+=encodeURIComponent(n)+%22=%22+encodeURIComponent(s[n])+%22%26%22);var%20r=%22json%22+%20++a;return%20o[r]=function(t){h(t);try{delete%20o[r]}catch(e){}o[r]=null},t(e+i+%22callback=%22+r),r}var%20s,i,n,a=0,o=this;return{get:e}}(),{request:function(t,e,s){if(this.calledByExtension())return%20this._callbacks[this._callbackId++]=s,void%20window.postMessage(JSON.stringify({from:%22kickassapp-page%22,url:t,type:%22callApi%22,params:e}),%22*%22);e=e||{};var%20i=%22%3F%22;for(key%20in%20e)e.hasOwnProperty(key)%26%26(i+=encodeURIComponent(key)+%22=%22+encodeURIComponent(e[key])+%22%26%22);var%20n=new%20XMLHttpRequest;n.onreadystatechange=function(){4==n.readyState%26%26s(JSON.parse(n.responseText))},n.open(%22GET%22,t+i),n.withCredentials=!0,n.setRequestHeader(%22Content-Type%22,%22application/json%22),n.send()},calledByExtension:function(){return!!document.getElementById(%22kickass-has-been-initialized-yes-yes-yes%22)},_callbacks:{},_callbackId:0});CORS.calledByExtension()%26%26window.addEventListener(%22message%22,function(t){var%20e;try{e=JSON.parse(t.data)}catch(t){return}if(%22kickassapp-extension%22===e.from%26%26%22kickassapp-extension-version1%22===e.sanityCheck){var%20s=e.payload;%22response%22===s.type%3F(CORS._callbacks[s.requestId](s.body),delete%20CORS._callbacks[s.requestId]):%22destroy%22===s.type%26%26window.KICKASSGAME.destroy()}},!1);var%20Class=function(t){var%20e=function(){return%20e.$prototyping%3Fthis:%22function%22==typeof%20this.initialize%3Fthis.initialize.apply(this,arguments):void%200};t.Extends%26%26(e.parent=t.Extends,t.Extends.$prototyping=!0,e.prototype=new%20t.Extends,t.Extends.$prototyping=!1);for(var%20s%20in%20t)t.hasOwnProperty(s)%26%26(e.prototype[s]=t[s]);return%20e};%22undefined%22!=typeof%20exports%26%26(exports.Class=Class);var%20Vector=new%20Class({initialize:function(t,e){%22object%22==typeof%20t%3F(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)},cp:function(){return%20new%20Vector(this.x,this.y)},mul:function(t){return%20this.x*=t,this.y*=t,this},mulNew:function(t){return%20new%20Vector(this.x*t,this.y*t)},div:function(t){return%20this.x/=t,this.y/=t,this},divNew:function(t){return%20new%20Vector(this.x/t,this.y/t)},add:function(t){return%20this.x+=t.x,this.y+=t.y,this},addNew:function(t){return%20new%20Vector(this.x+t.x,this.y+t.y)},sub:function(t){return%20this.x-=t.x,this.y-=t.y,this},subNew:function(t){return%20new%20Vector(this.x-t.x,this.y-t.y)},rotate:function(t){var%20e=this.x,s=this.y;return%20this.x=e*Math.cos(t)-Math.sin(t)*s,this.y=e*Math.sin(t)+Math.cos(t)*s,this},rotateNew:function(t){return%20this.cp().rotate(t)},setAngle:function(t){var%20e=this.len();return%20this.x=Math.cos(t)*e,this.y=Math.sin(t)*e,this},setAngleNew:function(t){return%20this.cp().setAngle(t)},setLength:function(t){var%20e=this.len();return%20e%3Fthis.mul(t/e):this.x=this.y=t,this},setLengthNew:function(t){return%20this.cp().setLength(t)},normalize:function(){var%20t=this.len();return%200==t%3Fthis:(this.x/=t,this.y/=t,this)},normalizeNew:function(){return%20this.cp().normalize()},angle:function(){return%20Math.atan2(this.y,this.x)},collidesWith:function(t){return%20this.x%3Et.x%26%26this.y%3Et.y%26%26this.x%3Ct.x+t.width%26%26this.y%3Ct.y+t.height},len:function(){var%20t=Math.sqrt(this.x*this.x+this.y*this.y);return.005%3Et%26%26t%3E-.005%3F0:t},is:function(t){return%22object%22==typeof%20t%26%26this.x==t.x%26%26this.y==t.y},dot:function(t){return%20this.x*t.x+this.y*t.y},inTriangle:function(t,e,s){var%20i=s.subNew(t),n=e.subNew(t),a=p.subNew(t),o=i.dot(i),h=i.dot(n),r=i.dot(a),l=n.dot(n),c=n.dot(a),d=1/(o*l-h*h),u=(l*r-h*c)*d,m=(o*c-h*r)*d;return%20u%3E0%26%26m%3E0%26%261%3Eu+m},distanceFrom:function(t){return%20Math.sqrt(Math.pow(this.x-t.x,2),Math.pow(this.y-t.y,2))},toString:function(){return%22[Vector(%22+this.x+%22,%20%22+this.y+%22)%20angle:%20%22+this.angle()+%22,%20length:%20%22+this.len()+%22]%22}});%22undefined%22!=typeof%20exports%26%26(exports.Vector=Vector);var%20Rect=new%20Class({initialize:function(t,e,s,i){this.pos=new%20Vector(t,e),this.size={width:s,height:i}},hasPoint:function(t){return%20t.x%3Ethis.getLeft()%26%26t.x%3Cthis.getRight()%26%26t.y%3Ethis.getTop()%26%26t.y%3Cthis.getBottom()},setLeft:function(t){this.pos.x=t+this.size.width/2},setTop:function(t){this.pos.y=t+this.size.height/2},getLeft:function(){return%20this.pos.x-this.size.width/2},getTop:function(){return%20this.pos.y-this.size.height/2},getRight:function(){return%20this.pos.x+this.size.width/2},getBottom:function(){return%20this.pos.y+this.size.height/2},cp:function(){return%20new%20Rect(this.pos.x,this.pos.y,this.size.width,this.size.height)}});%22undefined%22!=typeof%20exports%26%26(exports.Rect=Rect);var%20Fx=new%20Class({initialize:function(){this.listeners=[],this.tweens={},this.running={}},addListener:function(t){this.listeners.push(t)},add:function(t,e){if(e=e||{},e.duration=e.duration||500,e.transition=e.transition||Tween.Linear,e.repeats=%22undefined%22==typeof%20e.repeats%3F!1:e.repeats,!e.tweens){var%20s=e.start||0,i=%22undefined%22==typeof%20e.end%3F1:e.end;e.tweens=[[s,i]]}this.tweens[t]=e},update:function(t){t=%22number%22==typeof%20t%3Ft:now();for(var%20e%20in%20this.tweens)if(this.tweens.hasOwnProperty(e)){if(!this.running[e]){this.tweenStart(e,t);continue}var%20s=this.tweens[e],i=t-this.running[e].startTime;if(i%3Es.duration){this.tweenFinished(s,e);continue}for(var%20n,a=s.transition(i/s.duration),o=[],h=0;n=s.tweens[h];h++){var%20r=a*(n[1]-n[0])+n[0];o.push(r)}this.fire(e,o,a)}},tweenStart:function(t,e){this.running[t]={startTime:e};for(var%20s,i=[],n=0;s=this.tweens[t].tweens[n];n++)i.push(s[0]);this.fire(t,i,0)},tweenFinished:function(t,e){for(var%20s,i=[],n=0;s=t.tweens[n];n++)i.push(s[1]);return%20this.fire(e,i,1),t.repeats%3Fvoid%20this.tweenStart(e,now()):(delete%20this.running[e],void%20delete%20this.tweens[e])},fire:function(t,e,s){for(var%20i,n=0;i=this.listeners[n];n++)i.set.call(i,t,e,s)}}),Tween={Linear:function(t){return%20t},Quadratic:function(t){return%20t*t},Quintic:function(t){return%20t*t*t},Shake:function(t){return%20Math.sin(t)}},GameGlobals={FPS:60,useAnimationFrame:!1,boids:{flockRadius:400,size:100},path:function(){return%22https://kickassapp.com/%22+Array.prototype.slice.call(arguments).join(%22%22)},hasCanvas:%22undefined%22!=typeof%20document.createElement(%22canvas%22).getContext,bulletColor:%22black%22};window.GameGlobals=GameGlobals,Array.prototype.indexOf||(Array.prototype.indexOf=function(t){if(void%200===this||null===this)throw%20new%20TypeError;var%20e=Object(this),s=e.length%3E%3E%3E0;if(0===s)return-1;var%20i=0;if(arguments.length%3E0%26%26(i=Number(arguments[1]),i!==i%3Fi=0:0!==i%26%26i!==1/0%26%26i!==-(1/0)%26%26(i=(i%3E0||-1)*Math.floor(Math.abs(i)))),i%3E=s)return-1;for(var%20n=i%3E=0%3Fi:Math.max(s-Math.abs(i),0);s%3En;n++)if(n%20in%20e%26%26e[n]===t)return%20n;return-1});var%20requestAnimFrame=function(){return%20window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}(),KickAss=new%20Class({initialize:function(t){t%26%26t.mySite%26%26(this.mySite=t.mySite),this.players=[],this.elements=[],this.weaponClass=Weapons[1].cannonClass,this.scrollPos=new%20Vector(0,0),this.scrollSize=new%20Vector(0,0),this.windowSize={width:0,height:0},this.updateWindowInfo(),this.bulletManager=new%20BulletManager(this),this.bulletManager.updateEnemyIndex(),this.explosionManager=new%20ExplosionManager(this),this.ui=new%20UIManager(this),this.bombManager=new%20BombManager(this),this.menuManager=new%20MenuManager(this),this.menuManager.create(),%22undefined%22!=typeof%20StatisticsManager%26%26(this.statisticsManager=new%20StatisticsManager(this)),this.sessionManager=new%20SessionManager(this),this.lastUpdate=now(),this.keyMap={},this.keydownEvent=bind(this,this.keydown),this.keyupEvent=bind(this,this.keyup),this.multiplier=10,this.isCampaign()%3Fthis.audioManager={explosion:new%20AudioManager(GameGlobals.path(%22static/sounds/game/explosion%22),[%22mp3%22,%22ogg%22]),shot:new%20AudioManager(GameGlobals.path(%22static/sounds/game/shot%22),[%22mp3%22,%22ogg%22])}:this.audioManager={},window.KickAssStyle%26%26%22white%22===window.KickAssStyle%26%26(GameGlobals.bulletColor=%22white%22),addEvent(document,%22keydown%22,this.keydownEvent),addEvent(document,%22keyup%22,this.keyupEvent),addEvent(document,%22keypress%22,this.keydownEvent)},begin:function(){this.addPlayer(),this.sessionManager.isPlaying=!0,GameGlobals.useAnimationFrame||(this.loopTimer=window.setInterval(bind(this,this.loop),1e3/GameGlobals.FPS)),GameGlobals.useAnimationFrame%26%26requestAnimFrame(bind(this,this.loop))},keydown:function(t){var%20e=code(t.keyCode);switch(this.keyMap[e]=!0,e){case%22left%22:case%22right%22:case%22up%22:case%22down%22:case%22esc%22:case%22%20%22:stopEvent(t)}switch(e){case%22esc%22:this.destroy()}},keyup:function(t){var%20e=code(t.keyCode);switch(this.keyMap[e]=!1,e){case%22left%22:case%22right%22:case%22up%22:case%22down%22:case%22esc%22:case%22%20%22:t.stopPropogation%26%26t.stopPropogation(),t.preventDefault%26%26t.preventDefault(),t.returnValue=!1}},loop:function(){var%20t=now(),e=(t-this.lastUpdate)/1e3;this.updateWindowInfo();for(var%20s,i=0;s=this.players[i];i++)s.update(e);this.bulletManager.update(e),this.bombManager.update(e),this.explosionManager.update(e),this.ui.update(e),this.statisticsManager%26%26this.statisticsManager.update(e),this.sessionManager.update(e),this.lastUpdate=t,GameGlobals.useAnimationFrame%26%26requestAnimFrame(bind(this,this.loop))},addPlayer:function(){var%20t=Ships.Standard;window.KICKASSSHIP%26%26window.KICKASSSHIP.points%26%26(t=KICKASSSHIP),this.mySite%26%26this.mySite.getShipConfig()%26%26(t=this.mySite.getShipConfig());var%20e=new%20Player(this);e.setShip(t),this.players.push(e),this.explosionManager.addExplosion(e.pos)},registerElement:function(t){if(!t)throw%20new%20Error(%22Can't%20register%20unexisting%20element.%22);this.elements.push(t)},unregisterElement:function(t){this.elements.splice(this.elements.indexOf(t),1)},isKickAssElement:function(t){for(var%20e,s=0;e=this.elements[s];s++)if(t===e||elementIsContainedIn(e,t))return!0;return!1},isKeyPressed:function(t){return!!this.keyMap[t]},updateWindowInfo:function(){var%20t=!!window.ActiveXObject%26%26%22BackCompat%22==document.compatMode;this.windowSize={width:document.documentElement.clientWidth,height:document.documentElement.clientHeight},t%26%26(this.windowSize.width=document.body.clientWidth,this.windowSize.height=document.body.clientHeight),this.menuManager%26%26this.menuManager.isVisible()%26%26(this.windowSize.height-=this.menuManager.getHeight()),this.scrollPos.x=window.pageXOffset||document.documentElement.scrollLeft,this.scrollPos.y=window.pageYOffset||document.documentElement.scrollTop,this.scrollSize=getScrollSize()},hideAll:function(){for(var%20t,e=0;t=this.elements[e];e++)t.style.visibility=%22hidden%22},showAll:function(){for(var%20t,e=0;t=this.elements[e];e++)t.style.visibility=%22visible%22},updateShips:function(t,e){e||this.ui.showMessage(%22You're%20now%20flying%3Cbr%20/%3E%3Cem%3E%22+t.name+%22%3Cem%3E!!%22);for(var%20s,i=0;s=this.players[i];i++)s.setShip(t)},changeWeapon:function(t,e){this.weaponClass=t.cannonClass,e||this.ui.showMessage(%22Changed%20to%20%22+t.name.toUpperCase()+%22!!!!%22);for(var%20s,i=0;s=this.players[i];i++)s.setCannons(t.cannonClass)},changeWeaponById:function(t,e){Weapons[t]%26%26this.changeWeapon(Weapons[t],e)},flyOutPlayers:function(t,e){for(var%20s,i=0;s=this.players[i];i++)s.flyTo(t,-s.size.height),s.isBound=!1},flyInPlayers:function(){for(var%20t,e=0;t=this.players[e];e++)t.flyTo(t.pos.x,100,function(){this.isBound=!0})},newRank:function(t){this.ui.showMessage(%22OMG.%20You%20leveled%20up%20to:%20%3Cstrong%3E%22+t+%22%3C/strong%3E!%3Cbr%20/%3E%3Csmall%3EBe%20sure%20to%20check%20what%20cool%20new%20stuff%20you%20get%20in%20the%20menu.%3C/small%3E%22)},fireBomb:function(){this.bombManager.blow()},destroy:function(){removeEvent(document,%22keydown%22,this.keydownEvent),removeEvent(document,%22keypress%22,this.keydownEvent),removeEvent(document,%22keyup%22,this.keyupEvent);for(var%20t,e=0;t=this.players[e];e++)t.destroy();this.bulletManager.destroy(),this.explosionManager.destroy(),this.menuManager.destroy(),GameGlobals.useAnimationFrame||clearInterval(this.loopTimer),getGlobalNamespace().KICKASSGAME=!1,this.isCampaign()%26%26document.location.reload()},isCampaign:function(){return%20getGlobalNamespace().IS_CLOUDFLARE_GAME},isMySite:function(){return!!getGlobalNamespace().KICKASS_SITE_KEY},shouldShowAd:function(){return!this.mySite%26%26!this.isCampaign()},shouldShowMenu:function(){return!this.mySite%26%26!this.isCampaign()},shouldShowHowToImage:function(){return%20this.mySite||this.isCampaign()}});window.KickAss=KickAss;var%20StatisticsManager=new%20Class({initialize:function(t){this.game=t,this.data={},this.data.startedPlaying=now(),this.data.elementsDestroyed=0,this.data.shotsFired=0,this.data.distanceFlownInPixels=0,this.data.totalPointsThisSession=0,this.data.usedThrusters=0,this.lastUpdate=0},usedThrusters:function(){this.data.usedThrusters=1},increaseDistanceWithPixels:function(t){this.data.distanceFlownInPixels+=t},increasePointsGainedWithPoints:function(t){this.data.totalPointsThisSession+=t},addShotFired:function(){this.data.shotsFired++,this.game.audioManager.shot%26%26this.game.audioManager.shot.play()},addElementsDestroyed:function(){this.data.elementsDestroyed++},update:function(t){this.lastUpdate+=t,this.lastUpdate%3E.25%26%26(this.syncWithServer(),this.lastUpdate=0)},syncWithServer:function(){var%20t=[];for(var%20e%20in%20this.data)this.data.hasOwnProperty(e)%26%26t.push(e+%22:%22+this.data[e]);this.game.menuManager.sendMessageToMenu(%22stats:!%22+t.join(%22|%22))}}),MySite=new%20Class({initialize:function(t){this.key=t},load:function(t){CORS.request(GameGlobals.path(%22mysite/api.json%22),{site_key:this.key,url:document.location.toString()},bind(this,function(e){e%26%26e.embed%3F(this.mySiteData=e.embed,t(!0)):t(!1)}))},install:function(){},getShipId:function(){return%20this.mySiteData%26%26this.mySiteData.settings.ship},getShipConfig:function(){return%20this.mySiteData%26%26this.mySiteData.settings.ship_config},getShareURL:function(){return%20this.mySiteData%26%26this.mySiteData.settings.share_url}}),Menu=new%20Class({initialize:function(t){this.game=t,this.size={height:300}},generate:function(t){this.container=document.createElement(%22div%22),this.container.className=%22KICKASSELEMENT%22,this.container.id=%22kickass-profile-menu%22,t.appendChild(this.container);var%20e=getGlobalNamespace().KICKASSSHIPID||%22%22;this.url=GameGlobals.path(%22intermediate_postmessage.html%3Furl=%22+encodeURIComponent(getGlobalNamespace().KICKASSURL||document.location.href)+%22%26origin=%22+encodeURIComponent(document.location.href)+%22%26preship=%22+e+%22%26is_campaign=%22+(this.game.isCampaign()%3F%22true%22:%22%22)+%22%26is_mysite=%22+(this.game.isMySite()%3F%22true%22:%22%22)),this.isSocketReady=!1,this.socketIframe=document.createElement(%22iframe%22),this.socketIframe.frameborder=%220%22,this.socketIframe.className=%22KICKASSELEMENT%22,this.socketIframe.width=%22100%25%22,this.socketIframe.height=this.size.height+%22px%22,this.container.appendChild(this.socketIframe),this.menuOrigin=%22https://kickassapp.com/%22.replace(/\/$/,%22%22),this.socketIframe.src=this.url,this.onMessage=bind(this,function(t){if(t.origin!==this.menuOrigin%26%26t.origin!==this.menuOrigin.replace(%22http://%22,%22https://%22))return%20void%20console.log(%22ignoring%20event%20from%22,t.origin);var%20e=t.data;if(%22ready%22===e)return%20void%20this.onGameReady();var%20s=e.split(%22:!%22);if(2===s.length){var%20i=s.shift().replace(/^./g,function(t){return%20t.charAt(0).toUpperCase()});%22function%22==typeof%20this[%22messageType%22+i]%26%26this[%22messageType%22+i](s.join(%22:!%22))}}),window.addEventListener(%22message%22,this.onMessage,!1),this.game.registerElement(this.container)},socketPostMessage:function(t){this.socketIframe.contentWindow.postMessage(t,this.menuOrigin)},onGameReady:function(){this.isSocketReady=!0,this.game.registerElement(this.container.getElementsByTagName(%22iframe%22)[0]),this.socketPostMessage(%22url:!%22+(getGlobalNamespace().KICKASSURL||document.location.href)),this.game.statisticsManager%26%26this.game.statisticsManager.syncWithServer(),this.game.menuManager.onGameReady()},sendMessage:function(t){if(this.isSocketReady%26%26t!=this.lastMessage){try{this.socketPostMessage(t)}catch(e){}this.lastMessage=t}},messageTypeChangeShip:function(t){t=t.split(%22,%22);var%20e=t[0],s=(t[1],%22initial%22===t[2]);this.shipId!==e%26%26(s%26%26getGlobalNamespace().KICKASSSHIP||(this.shipId=e,CORS.request(GameGlobals.path(%22designer/ship/%22+e+%22/construction.json%22),{ship_id:e,is_initial:s%3F%221%22:%220%22},bind(this,function(t){this.game.updateShips(t.data,s);try{window.focus()}catch(e){}})),s||this.parent.hideMenu()))},messageTypeChangeWeapon:function(t,e){this.game.changeWeaponById(t,e)},messageTypeSetMultiplier:function(t){t=parseInt(t,10),!isNaN(t)%26%26t%26%26(this.game.multiplier=t)},messageTypeNewRank:function(t){this.game.newRank(t)},messageTypePlayerMessage:function(t){this.game.ui.showMessage(t)},destroy:function(){this.game.unregisterElement(this.container),this.game.unregisterElement(this.iframe),window.removeEventListener(%22message%22,this.onMessage,!1),this.container.parentNode.removeChild(this.container)}}),MenuManager=new%20Class({initialize:function(t){this.game=t,this.numPoints=0,getGlobalNamespace().KICKASS_INLINE_CSS||this.includeCSS(GameGlobals.path(%22css/menustyles.css%22))},generateDefaults:function(){for(var%20t%20in%20Weapons)Weapons.hasOwnProperty(t)%26%26this.addWeapon(Weapons[t],t);this.hideBombMenu()},create:function(){this.container=document.createElement(%22div%22),this.container.className=%22KICKASSELEMENT%20KICKASShidden%20%22+(this.game.shouldShowMenu()%3F%22%22:%22KICKASSNOMENU%22),this.container.id=%22kickass-menu%22,this.game.shouldShowMenu()%3F(this.container.style.bottom=%22-250px%22,this.container.style.display=%22none%22):removeClass(this.container,%22KICKASShidden%22),getAppContainerElement().appendChild(this.container);var%20t=this.game.shouldShowAd()%3F'%3Ciframe%20style=%22background:%20transparent%22%20src=%22'+GameGlobals.path(%22hello.html%22)+'%22%20class=%22KICKASSELEMENT%22%20id=%22kickass-hello-sunshine%22%3E%3C/iframe%3E':%22%22;this.container.innerHTML='%3Cdiv%20id=%22kickass-howto-image%22%20class=%22KICKASSELEMENT%20kickass-howto-invisible%22%3E%3C/div%3E%3Cdiv%20id=%22kickass-pointstab%22%20class=%22KICKASSELEMENT%22%3E'+t+'%3Cdiv%20id=%22kickass-bomb-menu%22%20class=%22KICKASSELEMENT%20KICKASShidden%22%3E%3Cul%20id=%22kickass-bomb-list%22%20class=%22KICKASSELEMENT%22%3E%3C/ul%3E%3C/div%3E%3Cdiv%20id=%22kickass-weapons-menu%22%20class=%22KICKASSELEMENT%20KICKASShidden%22%20style=%22display:none%22%3E%3Cul%20id=%22kickass-weapons-list%22%20class=%22KICKASSELEMENT%22%3E%3C/ul%3E%3C/div%3E%3Cdiv%20id=%22kickass-pointstab-wrapper%22%20class=%22KICKASSELEMENT%22%3E%3Cdiv%20id=%22kickass-points%22%20class=%22KICKASSELEMENT%22%3E'+this.numPoints+'%3C/div%3E%3Cdiv%20id=%22kickass-esctoquit%22%20class=%22KICKASSELEMENT%22%3EPress%20esc%20to%20quit%3C/div%3E'+this.getShareHTML()+'%3C/div%3E%3Cul%20id=%22kickass-pointstab-menu%22%20class=%22KICKASSELEMENT%22%20'+(this.game.shouldShowMenu()%3F%22%22:'style=%22display:none%22')+'%3E%3Cli%20class=%22KICKASSELEMENT%22%3E%3Ca%20class=%22KICKASSELEMENT%22%20id=%22kickass-link-highscores%22%20href=%22%23%22%3ESubmit%20score%3C/a%3E%3C/li%3E%3Cli%20class=%22KICKASSELEMENT%22%3E%3Ca%20class=%22KICKASSELEMENT%22%20id=%22kickass-link-menu%22%20href=%22%23%22%3EMenu%3C/a%3E%3C/li%3E%3Cli%20class=%22last-li%20KICKASSELEMENT%22%3E%3Ca%20class=%22KICKASSELEMENT%22%20id=%22kickass-link-ships%22%20href=%22%23%22%3ESwitch%20ship%3C/a%3E%3C/li%3E%3C/ul%3E%3C/div%3E',this.pointsTab=document.getElementById(%22kickass-pointstab%22),this.pointsTabWrapper=document.getElementById(%22kickass-pointstab-wrapper%22),this.points=document.getElementById(%22kickass-points%22),this.escToQuit=document.getElementById(%22kickass-esctoquit%22),this.howToImage=document.getElementById(%22kickass-howto-image%22),this.weaponsMenu=document.getElementById(%22kickass-weapons-menu%22),this.weaponsList=document.getElementById(%22kickass-weapons-list%22),this.bombLink=document.getElementById(%22kickass-bomb-menu%22),this.submitScoreLink=document.getElementById(%22kickass-link-highscores%22),this.menuLink=document.getElementById(%22kickass-link-menu%22),this.switchShipLink=document.getElementById(%22kickass-link-ships%22);for(var%20e=this.container.getElementsByTagName(%22*%22),s=0;s%3Ce.length;s++)this.game.registerElement(e[s]);this.game.registerElement(this.container),this.game.shouldShowMenu()%3F(this.menu=new%20Menu(this.game),this.menu.parent=this,this.menu.generate(this.container)):setTimeout(function(){this.onGameReady()}.bind(this),100),addEvent(this.submitScoreLink,%22click%22,bind(this,function(t){stopEvent(t),this.navigateTo(%22highscores%22)})),addEvent(this.menuLink,%22click%22,bind(this,function(t){stopEvent(t),this.toggleMenu(),this.navigateTo(%22main%22,!0)})),addEvent(this.switchShipLink,%22click%22,bind(this,function(t){stopEvent(t),this.navigateTo(%22ships%22)})),addEvent(this.bombLink,%22click%22,bind(this,function(t){stopEvent(t),this.game.fireBomb()})),addEvent(this.pointsTabWrapper,%22click%22,bind(this,this.toggleMenu)),addEvent(this.weaponsMenu,%22click%22,bind(this,this.toggleWeaponsMenu)),this.generateDefaults()},getShareHTML:function(){if(%22undefined%22!=typeof%20getGlobalNamespace().KICKASS_SHARE_URL){if(getGlobalNamespace().KICKASS_SHARE_URL){var%20t=encodeURIComponent(getGlobalNamespace().KICKASS_SHARE_URL);return'%3Ciframe%20class=%22KICKASSELEMENT%20kickass-like%22%20src=%22//www.facebook.com/plugins/share_button.php%3Fhref='+t+'%26amp;send=false%26amp;layout=button%26amp;width=47%26amp;show_faces=false%26amp;action=like%26amp;colorscheme=dark%26amp;font=arial%26amp;height=21%22%20scrolling=%22no%22%20frameborder=%220%22%20style=%22border:none;%20overflow:hidden;%20width:80px;%20height:21px;%22%20allowTransparency=%22true%22%3E%3C/iframe%3E'}return%22%22}var%20t=%22https://www.facebook.com/kickassapp%22;if(this.game.mySite){if(!this.game.mySite.getShareURL())return%22%22;t=this.game.mySite.getShareURL()}return'%3Ciframe%20class=%22KICKASSELEMENT%20kickass-like%22%20src=%22//www.facebook.com/plugins/like.php%3Fhref='+encodeURIComponent(t)+'%26amp;send=false%26amp;layout=button_count%26amp;width=47%26amp;show_faces=false%26amp;action=like%26amp;colorscheme=dark%26amp;font=arial%26amp;height=21%22%20scrolling=%22no%22%20frameborder=%220%22%20style=%22border:none;%20overflow:hidden;%20width:80px;%20height:21px;%22%20allowTransparency=%22true%22%3E%3C/iframe%3E'},onGameReady:function(){this.container.style.display=%22block%22,this.game.shouldShowHowToImage()%26%26(setTimeout(bind(this,function(){removeClass(this.howToImage,%22kickass-howto-invisible%22)}),10),setTimeout(bind(this,function(){addClass(this.howToImage,%22kickass-howto-invisible%22)}),4e3))},navigateTo:function(t,e){e||this.showMenu(),this.menu%26%26this.menu.socketPostMessage(%22navigate:!%22+t)},toggleMenu:function(){this.game.shouldShowMenu()%3FhasClass(this.container,%22KICKASShidden%22)%3Fthis.showMenu():this.hideMenu():this.showMenu()},toggleWeaponsMenu:function(){hasClass(this.weaponsMenu,%22KICKASShidden%22)%3Fthis.showWeaponsMenu():this.hideWeaponsMenu()},hideWeaponsMenu:function(){this.weaponsMenu.style.width=%22%22,addClass(this.weaponsMenu,%22KICKASShidden%22)},showWeaponsMenu:function(){var%20t=this.weaponsMenu.getElementsByTagName(%22li%22);t=t[t.length-1],this.weaponsMenu.style.width=t.offsetLeft+t.offsetWidth-47+%22px%22,removeClass(this.weaponsMenu,%22KICKASShidden%22)},showMenu:function(){this.game.shouldShowMenu()%26%26(this.container.style.bottom=%22%22,removeClass(this.container,%22KICKASShidden%22))},hideMenu:function(){this.container.style.bottom=%22%22,addClass(this.container,%22KICKASShidden%22)},showBombMenu:function(){this.bombLink.style.width=%22%22},hideBombMenu:function(){this.bombLink.style.width=%220px%22},getHeight:function(){return%20this.container.clientHeight},isVisible:function(){return!hasClass(this.container,%22KICKASShidden%22)},addPoints:function(t,e){var%20s=t*this.game.multiplier;this.numPoints+=s,this.points.innerHTML=this.numPoints,this.game.statisticsManager%26%26this.game.statisticsManager.increasePointsGainedWithPoints(s),this.game.ui.addPointsBubbleAt(e,s)},includeCSS:function(t){var%20e=document.createElement(%22link%22);e.rel=%22stylesheet%22,e.type=%22text/css%22,e.href=t,(document.head||document.body).appendChild(e)},sendMessageToMenu:function(t){this.menu%26%26this.menu.sendMessage(t)},addWeapon:function(t,e){var%20s=document.createElement(%22li%22);s.className=%22KICKASSELEMENT%20kickass-weapon-item%22,s.weapon=t,s.style.backgroundImage=%22url(%22+GameGlobals.path(%22css/gfx/kickass/weap-%22+t.id+%22.png%22)+%22)%22,s.innerHTML='%3Cspan%20class=%22KICKASSELEMENT%22%3E'+t.name+%22%3C/span%3E%22,this.weaponsList.appendChild(s),addEvent(s,%22click%22,bind(this,function(s){stopEvent(s),this.changeWeapon(t),this.sendMessageToMenu(%22changeWeapon:!%22+e)}))},changeWeapon:function(t){this.game.changeWeapon(t)},destroy:function(){for(var%20t=this.container.getElementsByTagName(%22*%22),e=0;e%3Ct.length;e++)this.game.unregisterElement(t[e]);this.game.unregisterElement(this.container),this.menu%26%26this.menu.destroy(),this.container.parentNode.removeChild(this.container)}}),UIManager=new%20Class({initialize:function(t){this.UNIQID=0,this.game=t,this.pointBubbles={},this.messages={},this.fx=new%20Fx,this.fx.addListener(this)},update:function(t){this.fx.update()},set:function(t,e,s){var%20i=t.split(%22-%22)[0],n=t.split(%22-%22)[1];if(this.pointBubbles[n]){var%20a=this.pointBubbles[n];a.style.top=e[0]+%22px%22,a.style.opacity=e[1],1==s%26%26a.parentNode%26%26(a.parentNode.removeChild(a),delete%20this.pointBubbles[n])}else%20if(this.messages[n]%26%26%22messagedown%22==i){var%20o=this.messages[n];o.style.top=e[0]+%22px%22,1==s%26%26setTimeout(bind(this,function(){this.fx.add(%22messageup-%22+n,{tweens:[[e[0],-100]],transition:Tween.Quadratic,duration:300})}),o.staytime||4e3)}else%20if(this.messages[n]%26%26%22messageup%22==i){var%20o=this.messages[n];o.style.top=e[0]+%22px%22,1==s%26%26(o.parentNode.removeChild(o),delete%20this.messages[n])}},addPointsBubbleAt:function(t,e){var%20s=%22bubble%22+this.UNIQID++,i=this.game.scrollPos.y+t.y,n=newElement(%22span%22,{innerHTML:e,className:%22KICKASSELEMENT%22,styles:{position:%22absolute%22,font:%2220px%20Arial%22,fontWeight:%22bold%22,opacity:%221%22,color:%22black%22,textShadow:%22%23fff%201px%201px%203px%22,top:i,zIndex:%2210000000%22}});n.style.left=t.x-n.offsetWidth/2+%22px%22,getAppContainerElement().appendChild(n),this.pointBubbles[s]=n,this.fx.add(%22bubble-%22+s,{tweens:[[i,i-15],[1,0]]})},showMessage:function(t,e){e=e||!1;var%20s=300,i=this.UNIQID++,n=newElement(%22div%22,{innerHTML:t,className:%22KICKASSELEMENT%22,id:%22kickass-message-%22+i,styles:{position:%22fixed%22,top:-100,left:%2250%25%22,marginLeft:-s/2,width:s,background:%22%23222%22,opacity:.8,padding:%2210px%22,color:%22%23fff%22,textAlign:%22center%22,borderRadius:15,font:%2220px%20Arial%22,fontWeight:%22bold%22,zIndex:%2210000000%22}});n.staytime=e,getAppContainerElement().appendChild(n);var%20a=this.getLowestBubbleY();return%20n.kickassto=a,this.fx.add(%22messagedown-%22+i,{duration:300,tweens:[[-100,a]],transition:Tween.Quadratic}),this.messages[i]=n,n},getLowestBubbleY:function(){var%20t=100;for(var%20e%20in%20this.messages)this.messages.hasOwnProperty(e)%26%26(t=Math.max(this.messages[e].kickassto+this.messages[e].offsetHeight+10,t));return%20t}}),AudioManager=new%20Class({initialize:function(t,e){if(this.src=t,this.formats=e,channels=8,this.supportsAudio=%22undefined%22!=typeof%20document.createElement(%22audio%22).play,this.supportsAudio){this.numChannels=channels,this.channels=[];for(var%20s=0;s%3Cthis.numChannels;s++)this.channels.push({isPlaying:!1,element:this.prepareElement(this.buildAudioElement())})}},buildAudioElement:function(){for(var%20t,e={ogg:%22audio/ogg%22,mp3:%22audio/mpeg%22},s=document.createElement(%22audio%22),i=0;t=this.formats[i];i++){var%20n=document.createElement(%22source%22);n.src=this.src+%22.%22+t,n.type=e[t],s.appendChild(n)}return%20s},prepareElement:function(t){if(%22undefined%22==typeof%20t.addEventListener)return%20t;var%20e=this;return%20t.addEventListener(%22ended%22,function(s){e.audioEnded(t)},!1),t},audioEnded:function(t){for(var%20e,s=0;e=this.channels[s];s++)e.element===t%26%26(e.isPlaying=!1)},play:function(){if(this.supportsAudio)for(var%20t,e=0;t=this.channels[e];e++)if(!t.isPlaying)return%20t.isPlaying=!0,void(%22function%22==typeof%20t.element.play%26%26t.element.play())}}),Ships={Standard:{points:[[-10,10],[0,-15],[10,10]],thrusters:[{s:{w:20,h:7},p:{x:0,y:14},a:0}],cannons:[{p:{x:0,y:-15},a:0}]}},PLAYERIDS=0,Player=new%20Class({initialize:function(t){this.id=PLAYERIDS++,this.game=t,this.tween=!1,this.isBound=!0,this.pos=new%20Vector(200,200),this.vel=new%20Vector(0,0),this.acc=new%20Vector(0,0),this.dir=new%20Vector(0,1),this.currentRotation=0,this.isBroken=!1,this.lineOffsets=[],this.deadTime=0,this.friction=.8,this.terminalVelocity=2e3,this.lastPos=new%20Vector(0,0)},setShip:function(t){this.ship=t,this.verts=[];for(var%20e,s=0;e=this.ship.points[s];s++)this.verts.push(new%20Vector(e[0],e[1]));this.verts.push(this.verts[0]),this.thrusters=[],this.cannons=[],this.addThrusters(this.ship.thrusters),this.addCannons(this.ship.cannons),this.size=this.getSizeFromVertsAndObjects(),this.bounds=this.calculateBounds(),this.sheet%26%26this.sheet.destroy(),this.sheet=new%20Sheet(new%20Rect(100,100,this.bounds.x,this.bounds.y)),this.forceRedraw=!0},setCannons:function(t){for(var%20e,s=[],i=0;e=this.cannons[i];i++){var%20n=new%20t(this,this.game,e.pos.x,e.pos.y,e.angle);s.push(n),e.destroy()}this.cannons=s},addThrusters:function(t){for(var%20e,s=0;e=t[s];s++){var%20i=new%20Thruster(e);this.thrusters.push(i)}},addCannons:function(t){for(var%20e,s=0;e=t[s];s++){var%20i=WeaponMap[e.m]||WeaponMap.cannon,n=new%20i.cannonClass(this,this.game,e.p.x,e.p.y,e.a);n.player=this,n.game=this.game,this.cannons.push(n)}},update:function(t){if(this.isBroken){if(!this.lineOffsets.length)for(var%20e=0;e%3Cthis.verts.length-1;e++)this.lineOffsets[e]={pos:new%20Vector(0,0),dir:new%20Vector(1,1).setAngle(2*Math.PI*Math.random())};for(var%20e=0;e%3Cthis.lineOffsets.length;e++)this.lineOffsets[e].pos.add(this.lineOffsets[e].dir.cp().setLength(50).mul(t));return%20this.sheet.clear(),this.sheet.setAngle(this.dir.angle()),this.sheet.setPosition(this.pos),this.sheet.drawBrokenPlayer(this.verts,this.lineOffsets),void(now()-this.deadTime%3E1e3%26%26(this.isBroken=!1,this.lineOffsets=[],this.randomPos()))}this.tween||(this.game.isKeyPressed(%22left%22)||this.game.isKeyPressed(%22right%22)%3F(this.game.isKeyPressed(%22left%22)%26%26this.rotateLeft(t),this.game.isKeyPressed(%22right%22)%26%26this.rotateRight(t)):this.stopRotate(),this.game.isKeyPressed(%22up%22)%3Fthis.activateThrusters():this.stopThrusters()),this.game.isKeyPressed(%22%20%22)%3F(this.isShooting=!0,this.isBroken||this.shootPressed()):this.isShooting%26%26(this.isShooting=!1,this.shootReleased()),this.currentRotation%26%26this.dir.setAngle(this.dir.angle()+this.currentRotation*t);var%20s=this.acc.mulNew(t).sub(this.vel.mulNew(t*this.friction));this.vel.add(s),this.vel.len()%3Ethis.terminalVelocity%26%26this.vel.setLength(this.terminalVelocity);var%20i=this.vel.mulNew(t);this.pos.add(i),this.game.statisticsManager%26%26this.game.statisticsManager.increaseDistanceWithPixels(i.len());for(var%20n,a=!this.acc.is({x:0,y:0}),e=0;n=this.thrusters[e];e++)n.setIsShown(a),n.update(t);if(this.isBound%26%26this.checkBounds(),!this.lastPos.is(this.pos)||this.currentRotation||this.forceRedraw){if(this.forceRedraw=!1,this.sheet.clear(),this.sheet.setAngle(this.dir.angle()+Math.PI/2),this.sheet.setPosition(this.pos),a)for(var%20n,e=0;n=this.thrusters[e];e++)n.drawTo(this.sheet);this.sheet.drawPlayer(this.verts),this.lastPos=this.pos.cp()}for(var%20o,e=0;o=this.cannons[e];e++)o.update(t)},randomPos:function(){var%20t=this.game.windowSize.width,e=this.game.windowSize.height;this.pos=new%20Vector(random(0,t),random(0,e))},checkBounds:function(){if(!this.tween){var%20t=this.game.windowSize.width,e=this.game.windowSize.height,s=this.pos.x+this.sheet.rect.size.width/2,i=this.pos.y+this.sheet.rect.size.height/2;s%3Et%3F(window.scrollTo(this.game.scrollPos.x+50,this.game.scrollPos.y),this.pos.x=0):this.pos.x%3C0%26%26(window.scrollTo(this.game.scrollPos.x-50,this.game.scrollPos.y),this.pos.x=t-this.sheet.rect.size.width/2),i%3Ee%3F(window.scrollTo(this.game.scrollPos.x,this.game.scrollPos.y+.75*e),this.pos.y=0):this.pos.y%3C0%26%26(window.scrollTo(this.game.scrollPos.x,this.game.scrollPos.y-.75*e),this.pos.y=e-this.sheet.rect.size.height/2)}},inRect:function(t){for(var%20e,s=!1,i=0;e=this.verts[i];i++)t.hasPoint(new%20Vector(e.x+this.pos.x,e.y+this.pos.y))%26%26(s=!0);return%20s},hit:function(t){this.isBroken||(this.isBroken=!0,this.deadTime=now())},activateThrusters:function(){this.game.statisticsManager%26%26this.game.statisticsManager.usedThrusters(),this.acc=new%20Vector(500,0).setAngle(this.dir.angle())},stopThrusters:function(){this.acc=new%20Vector(0,0)},rotateLeft:function(t){this.currentRotation=Math.max(2*-Math.PI,this.currentRotation-10*Math.PI*t)},rotateRight:function(t){this.currentRotation=Math.min(2*Math.PI,this.currentRotation+10*Math.PI*t)},stopRotate:function(){this.currentRotation=0},getSizeFromVertsAndObjects:function(){for(var%20t,e=0,s=0;t=this.verts[s];s++)e=Math.max(e,new%20Vector(t).len());for(var%20i,s=0;i=this.thrusters[s];s++){var%20n=new%20Vector(i.pos.x-i.size.width/2,i.pos.y-i.size.height/2).rotate(i.angle),a=new%20Vector(i.pos.x+i.size.width/2,i.pos.y-i.size.height/2).rotate(i.angle),o=new%20Vector(i.pos.x-i.size.width/2,i.pos.y+i.size.height/2).rotate(i.angle),h=new%20Vector(i.pos.x+i.size.width/2,i.pos.y+i.size.height/2).rotate(i.angle);e=Math.max(e,n.len(),a.len(),o.len(),h.len())}return{width:2*e,height:2*e}},calculateBounds:function(){return{x:1*Math.max(this.size.width,this.size.height),y:1*Math.max(this.size.height,this.size.width)}},shootPressed:function(){for(var%20t,e=0;t=this.cannons[e];e++)t.shootPressed()},shootReleased:function(){for(var%20t,e=0;t=this.cannons[e];e++)t.shootReleased()},flyTo:function(t,e,s){this.tween={start:{pos:this.pos.cp(),dir:this.dir.cp()},to:new%20Vector(t,e),callback:s||function(){}},this.tween.time=this.getTimeforTween()},destroy:function(){this.sheet.destroy()}}),Thruster=new%20Class({initialize:function(t,e){this.pos=new%20Vector(t.p),this.size={width:t.s.w,height:t.s.h},this.angle=t.a||0,this.ship=e,this.isShown=!1,this.flameY=1,this.fx=new%20Fx,this.fx.addListener(this),this.flames={r:[],y:[]},this.lastFrameUpdate=0,this.generateFlames()},update:function(t){this.fx.update(),now()-this.lastFrameUpdate%3E1e3/60%26%26this.generateFlames()},set:function(t,e){switch(t){case%22flames%22:this.flameY=e}},setIsShown:function(t){!this.isShown%26%26t%26%26(this.flameY=0,this.generateFlames(),this.fx.add(%22flames%22,{start:this.flameY,end:1,duration:250,transition:Tween.Quintic})),this.isShown=t},drawTo:function(t){t.drawFlames(this.flames,this.angle)},generateFlames:function(){function%20t(t,e){return%20new%20Vector(t,e)}var%20e=this.size.width,s=.05*this.size.width,i=.8*this.size.width,n=.1*i,a=e/2,o=i/2,h=(-this.size.height/2,this.pos.x),r=this.pos.y-this.size.height/2;this.flames.r=[t(-a+h,r)],this.flames.y=[t(-o+h,r)],this.flames.self=this;for(var%20l=0;e%3El;l+=s)this.flames.r.push(t(l-a+h,this.flameY*random(.7*this.size.height,this.size.height)+r));this.flames.r.push(t(a+h,r));for(var%20l=0;i%3El;l+=n)this.flames.y.push(t(l-o+h,this.flameY*random(.4*this.size.height,.7*this.size.height)+r));this.flames.y.push(t(o+h,r)),this.lastFrameUpdate=now();for(var%20c,d=t(h,r),u=0;c=this.flames.r[u];u++)c.sub(d).rotate(this.angle).add(d);for(var%20c,u=0;c=this.flames.y[u];u++)c.sub(d).rotate(this.angle).add(d)}}),BombManager=new%20Class({initialize:function(t){this.game=t,this.bombShowDelay=30,this.nextBomb=this.bombShowDelay},update:function(t){this.game.isKeyPressed(%22F%22)%26%26this.isReady()%26%26this.blow(),-1!==this.nextBomb%26%26this.game.sessionManager.isPlaying%26%26(this.nextBomb-=t,this.nextBomb%3C0%26%26(this.game.menuManager.showBombMenu(),this.nextBomb=-1,this.game.ui.showMessage(%22BOMB%20IS%20READY%3Cbr%20/%3E(lower%20right%20corner%20or%20F)%22)))},blow:function(){var%20t=this.game.ui.showMessage(%223...%22,5e3);delay(1e3,function(){t.innerHTML=%222...%22},this),delay(2e3,function(){t.innerHTML=%221...%22},this),delay(3e3,function(){t.innerHTML=%22boom%22},this),delay(3e3,this.blowStuffUp,this),this.nextBomb=this.bombShowDelay},blowStuffUp:function(){this.game.bulletManager.updateEnemyIndex();for(var%20t,e=this.game.bulletManager.enemyIndex,s=0;(t=e[s])%26%2610%3Es;s++){var%20i=getRect(t),n=new%20Vector(i.left+i.width/2,i.top+i.height/2);this.game.explosionManager.addExplosion(n,t,MegaParticleExplosion),t.parentNode.removeChild(t)}this.game.menuManager.hideBombMenu(),this.nextBomb=this.bombShowDelay},isReady:function(){return-1===this.nextBomb}}),ELEMENTSTHATARENOTTOBEINCLUDED=[%22BR%22,%22SCRIPT%22,%22STYLE%22,%22TITLE%22,%22META%22,%22HEAD%22,%22OPTION%22,%22OPTGROUP%22,%22LINK%22],ELEMENTSIZETHRESHOLD=5,BulletManager=new%20Class({initialize:function(t){this.game=t,this.lastBlink=0,this.blinkActive=!1,this.enemyIndex=[],this.updateDelay=2.5,this.nextUpdate=this.updateDelay},update:function(t){this.game.isKeyPressed(%22B%22)%3Fthis.blink():this.blinkActive%26%26this.endBlink(),this.nextUpdate-=t,this.nextUpdate%3C0%26%26this.updateEnemyIndex()},blink:function(){if(now()-this.lastBlink%3E250){for(var%20t,e=0;t=this.enemyIndex[e];e++)this.blinkActive%3Ft.style.outline=t.KICKASSOLDBORDER:t.style.outline=%221px%20solid%20red%22;this.blinkActive=!this.blinkActive,this.lastBlink=now(),this.blinkActive||this.updateEnemyIndex()}},endBlink:function(){for(var%20t,e=0;t=this.enemyIndex[e];e++)t.style.outline=t.KICKASSOLDBORDER;this.lastBlink=0,this.blinkActive=!1},updateEnemyIndex:function(){var%20t=document.getElementsByTagName(%22*%22);this.enemyIndex=[];for(var%20e,s=0;e=t[s];s++)this.isDestroyable(e)%26%26(this.enemyIndex.push(e),e.KICKASSOLDBORDER=e.style.outline||document.defaultView.getComputedStyle(e,null).outline);this.nextUpdate=this.updateDelay},isDestroyable:function(t,e){if(this.shouldIgnoreElement(t,e))return!1;for(var%20s,i=0;s=t.childNodes[i];i++)if(1===s.nodeType%26%26-1===ELEMENTSTHATARENOTTOBEINCLUDED.indexOf(s.tagName)%26%26s.offsetWidth%3E=ELEMENTSIZETHRESHOLD%26%26s.offsetHeight%3E=ELEMENTSIZETHRESHOLD%26%26%22hidden%22!==document.defaultView.getComputedStyle(s,null).visibility)return!1;return!0},isDestroyableFromCollision:function(t){return%20this.isDestroyable(t,!0)},shouldIgnoreElement:function(t,e){if(1!==t.nodeType)return!0;if(t==document.documentElement||t==document.body)return!0;if(-1!==ELEMENTSTHATARENOTTOBEINCLUDED.indexOf(t.tagName))return!0;if(%22hidden%22==t.style.visibility||%22none%22==t.style.display)return!0;if(%22string%22==typeof%20t.className%26%26-1!=t.className.indexOf(%22KICKASSELEMENT%22))return!0;if(!e%26%26(t.offsetWidth%3CELEMENTSIZETHRESHOLD||t.offsetHeight%3CELEMENTSIZETHRESHOLD))return!0;var%20s;return(t.offsetLeft%3C0||t.offsetTop%3C0)%26%26(s=getRect(t),s.left+s.width%3C0||s.top+s.height%3C0)%3F!0:(s||(s=getRect(t)),s.top%3E=this.game.scrollSize.y%3F!0:!1)},destroy:function(){for(var%20t%20in%20this.bullets)if(this.bullets.hasOwnProperty(t))for(var%20e,s=0;e=this.bullets[t][s];s++)e.destroy();this.bullets={}}}),SessionManager=new%20Class({initialize:function(t){this.game=t,this.isPlaying=!1},update:function(t){this.isPlaying%26%260==this.game.bulletManager.enemyIndex.length%26%26this.weHaveWon()},weHaveWon:function(){this.isPlaying=!1,this.game.ui.showMessage(%22You're%20done!%22),this.game.isCampaign()%3F(this.game.menuManager.showMenu(),this.game.menuManager.navigateTo(%22highscores%22)):this.game.menuManager.showMenu(),this.game.menuManager.sendMessageToMenu(%22gameFinished:!%22)}}),ExplosionManager=new%20Class({initialize:function(t){this.game=t,this.explosions=[]},update:function(t){for(var%20e,s=now(),i=0;e=this.explosions[i];i++)s-e.bornAt%3E(e.ttl||500)%3F(e.destroy(),this.explosions.splice(i,1)):e.update(t)},addExplosion:function(t,e,s){s=s||ParticleExplosion;var%20i=new%20s(t,e);i.game=this.game,i.checkBounds(),this.explosions.push(i),this.game.audioManager.explosion%26%26this.game.audioManager.explosion.play()},destroy:function(){for(var%20t,e=0;t=this.explosions[e];e++)t.destroy();this.explosions=[]}}),Cannon=new%20Class({initialize:function(t,e,s,i,n){this.player=t,this.game=e,this.pos=new%20Vector(s,i),this.angle=n||0},shootPressed:function(){},shootReleased:function(){},checkCollisions:function(){},getExplosionClass:function(){return%20ParticleExplosion},update:function(t){this.game.hideAll(),this.checkCollisions(t),this.game.showAll()},checkCollision:function(t){var%20e=t.checkCollision();return%20e%3F(this.game.explosionManager.addExplosion(t.pos,e,this.getExplosionClass()),this.game.menuManager.addPoints(Math.min(e.getElementsByTagName(%22*%22).length+1,100),t.pos),e.isShot||e.parentNode.removeChild(e),this.game.statisticsManager%26%26this.game.statisticsManager.addElementsDestroyed(),!0):!1},createBullet:function(t){var%20e=this.getABulletPos(),s=this.getABulletDir(),i=new%20t(e,s);return%20i.game=this.game,i.manager=this,i.initCanvas(),i.vel.add(i.vel.cp().setLength(this.player.vel.len())),i},getABulletPos:function(){return%20this.player.pos.cp().add(this.pos.cp().rotate(this.player.dir.angle()+Math.PI/2))},getABulletDir:function(){return%20this.player.dir.cp().rotate(this.angle)},destroy:function(){}}),LaserCannon=new%20Class({Extends:Cannon,initialize:function(t,e,s,i,n){Cannon.prototype.initialize.apply(this,arguments),this.lasers=[]},getExplosionClass:function(){return%20SplitExplosion},update:function(t){this.lasers.length%26%26(this.removeOld(),Cannon.prototype.update.call(this,t))},checkCollisions:function(t){for(var%20e,s=0;e=this.lasers[s];s++)e.update(t),this.checkCollision(e)},removeOld:function(){for(var%20t,e=0;t=this.lasers[e];e++)t.outOfBounds%26%26(t.destroy(),this.lasers.splice(e,1))},shootPressed:function(){this.lasers.length%3E5||now()-this.lastFired%3C500||(this.lastFired=now(),this.game.statisticsManager%26%26this.game.statisticsManager.addShotFired(),this.lasers.push(this.createBullet(LaserBullet)))},destroy:function(){if(this.lasers.length){for(var%20t,e=0;t=this.lasers[e];e++)t.destroy();this.lasers=[]}}}),BallCannon=new%20Class({Extends:Cannon,initialize:function(){Cannon.prototype.initialize.apply(this,arguments),this.lastFired=0,this.bullets=[]},getExplosionClass:function(){return%20ParticleExplosion},update:function(t){this.bullets.length%26%26(this.removeOld(),Cannon.prototype.update.call(this,t))},removeOld:function(){for(var%20t,e=now(),s=0;t=this.bullets[s];s++)e-t.bornAt%3E2e3%26%26(t.destroy(),this.bullets.splice(s,1))},checkCollisions:function(t){for(var%20e,s=0;e=this.bullets[s];s++)e.update(t),this.checkCollision(e)%26%26(e.destroy(),this.bullets.splice(s,1))},shootPressed:function(){now()-this.lastFired%3C200||(this.lastFired=now(),this.addBullet(),this.game.statisticsManager%26%26this.game.statisticsManager.addShotFired())},addBullet:function(){this.bullets.length%3E7%26%26(this.bullets[0].destroy(),this.bullets.shift());var%20t=this.createBullet(Bullet);this.bullets.push(t)},destroy:function(){for(var%20t,e=0;t=this.bullets[e];e++)t.destroy();this.bullets=[]}}),Bullet=new%20Class({initialize:function(t,e){this.pos=t.cp(),this.dir=e,this.vel=new%20Vector(500,500),this.bornAt=now()},initCanvas:function(){this.sheet=new%20Sheet(new%20Rect(this.pos.x,this.pos.y,5,5)),this.sheet.drawBullet()},draw:function(){this.sheet.setPosition(this.pos)},update:function(t){this.pos.add(this.vel.setAngle(this.dir.angle()).mulNew(t)),this.checkBounds(),this.draw()},checkCollision:function(){var%20t=document.elementFromPoint(this.pos.x,this.pos.y);t%26%263==t.nodeType%26%26(t=t.parentNode);var%20e=t%26%26this.game.bulletManager.isDestroyableFromCollision(t)%3Ft:!1;return%20e},checkBounds:function(){var%20t=this.game.windowSize.width,e=this.game.windowSize.height,s=this.pos.x+this.sheet.rect.size.width/2,i=this.pos.y+this.sheet.rect.size.height/2;s%3Et%3Fthis.pos.x=0:this.pos.x%3C0%26%26(this.pos.x=t-this.sheet.rect.size.width/2),i%3Ee%3Fthis.pos.y=0:this.pos.y%3C0%26%26(this.pos.y=e-this.sheet.rect.size.height/2)},destroy:function(){this.sheet.destroy()}}),LaserBullet=new%20Class({Extends:Bullet,initialize:function(){Bullet.prototype.initialize.apply(this,arguments),this.vel=new%20Vector(750,750),this.lastDrawPos=this.pos.cp()},initCanvas:function(){var%20t=Math.max(GameGlobals.laserImage.width,GameGlobals.laserImage.height);this.sheet=new%20Sheet(new%20Rect(0,0,t,t))},update:function(t){Bullet.prototype.update.apply(this,arguments)},draw:function(){this.sheet.drawLaser(this.pos,this.dir),this.lastDrawPos=this.pos.cp()},checkBounds:function(){var%20t=this.game.windowSize.width,e=this.game.windowSize.height,s=this.pos.x+this.sheet.rect.size.width/2,i=this.pos.y+this.sheet.rect.size.height/2;(s%3Et||this.pos.x%3C0)%26%26(this.outOfBounds=!0),(i%3Ee||this.pos.y%3C0)%26%26(this.outOfBounds=!0)},destroy:function(){this.sheet.destroy()}});GameGlobals.laserImage=document.createElement(%22img%22),GameGlobals.laserImage.src=GameGlobals.path(%22css/gfx/kickass/laser.png%22);var%20Explosion=new%20Class({initialize:function(t,e){this.bornAt=now(),this.pos=t.cp()},update:function(t){},checkBounds:function(){},destroy:function(){}}),ParticleExplosion=new%20Class({Extends:Explosion,initialize:function(t,e){Explosion.prototype.initialize.apply(this,arguments),this.particleVel=new%20Vector(150,0),this.particles=[],this.generateParticles(),this.sheet=new%20Sheet(new%20Rect(t.x,t.y,250,250))},update:function(t){for(var%20e,s=0;e=this.particles[s];s++)e.pos.add(e.vel.mulNew(t).mul(random(.5,1)).setAngle(e.dir.angle()));this.sheet.clear(),this.sheet.drawExplosion(this.particles)},generateParticles:function(){for(var%20t=0,e=GameGlobals.hasCanvas%3F40:10;e%3Et;t++)this.particles.push({dir:new%20Vector(random(0,20)-10,random(0,20)-10).normalize(),vel:this.particleVel.cp(),pos:new%20Vector(0,0),color:[%22yellow%22,%22red%22][random(0,1)]})},checkBounds:function(){var%20t=this.sheet.rect.getRight(),e=this.sheet.rect.getBottom(),s=this.game.windowSize.width,i=this.game.windowSize.height;t%3Es%26%26(this.pos.x-=t-s),e%3Ei%26%26(this.pos.y-=e-i),this.sheet.setPosition(this.pos)},destroy:function(){this.sheet.destroy()}}),MegaParticleExplosion=new%20Class({Extends:ParticleExplosion,initialize:function(t,e){Explosion.prototype.initialize.apply(this,arguments),this.particleVel=new%20Vector(200,0),this.particles=[],this.generateParticles(),this.sheet=new%20Sheet(new%20Rect(t.x,t.y,500,500)),this.ttl=2e3,this.generationDelay=.6,this.generationTimes=2,this.nextGenerate=this.generationDelay},update:function(t){this.nextGenerate-=t,this.nextGenerate%3C=0%26%26this.generationTimes%3E0%26%26(this.nextGenerate=this.generationDelay,this.generateParticles(),this.generationTimes--),ParticleExplosion.prototype.update.call(this,t)}}),SplitExplosion=new%20Class({Extends:Explosion,initialize:function(t,e){e%26%26(Explosion.prototype.initialize.apply(this,arguments),this.element=e,this.fx=new%20Fx,this.fx.addListener(this),this.start())},update:function(t){this.element%26%26this.fx.update()},set:function(t,e){},start:function(){var%20t=this.createClones(),e=t[0],s=t[1],i=%22rotate(-%22+random(30,50)+%22deg)%20translate(-100px,%2040px)%22,n=%22rotate(%22+random(30,50)+%22deg)%20translate(100px,%2040px)%22;setStyles(e,{transform:i}),setStyles(s,{transform:n}),this.left=e,this.right=s,this.fx.add(%22opacity%22,{start:1,end:.5,duration:500})},createClones:function(){var%20t=getRect(this.element),e=this.createContainer(t),s=this.createContainer(t),i=cloneElement(this.element),n=cloneElement(this.element);addClass(i,%22KICKASSELEMENT%22),addClass(n,%22KICKASSELEMENT%22);var%20a={margin:0,overflow:%22hidden%22};return%20setStyles(i,a),setStyles(n,a),e.appendChild(i),s.appendChild(n),s.style.left=t.left+t.width/2+%22px%22,s.scrollLeft+=t.width/2,this.element.style.opacity=0,this.element.style.visibility=%22hidden%22,this.element.style.display=%22none%22,each([e,s],function(t){t.style.transition=%22transform%20500ms%20ease-in%22})},createContainer:function(t){var%20e=document.createElement(%22div%22);return%20setStyles(e,{position:%22absolute%22,left:t.left,top:t.top,width:.5*t.width,height:t.height,overflow:%22hidden%22}),getAppContainerElement().appendChild(e),e},destroy:function(){try{this.left.parentNode.removeChild(this.left),this.right.parentNode.removeChild(this.right),this.element.parentNode.removeChild(this.element)}catch(t){}}}),Weapons={1:{name:%22Cannon%22,id:%22cannon%22,cannonClass:BallCannon},2:{name:%22Laser%22,id:%22laser%22,cannonClass:LaserCannon}},WeaponMap={cannon:Weapons[1],laser:Weapons[2]},SheetCanvas=new%20Class({initialize:function(rect){with(this.canvas=document.createElement(%22canvas%22),this.canvas.className=%22KICKASSELEMENT%22,this.canvas.style)position=%22absolute%22,zIndex=%221000000%22;GameGlobals.kickass.registerElement(this.canvas),this.canvas.getContext%26%26(this.ctx=this.canvas.getContext(%222d%22)),this.rect=rect,this.angle=0,this.updateCanvas(),getAppContainerElement().appendChild(this.canvas)},tracePoly:function(t){if(t[0]){this.ctx.save(),this.ctx.translate(this.rect.size.width/2,this.rect.size.height/2),this.ctx.rotate(this.angle),this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(var%20e=0;e%3Ct.length;e++)this.ctx.lineTo(t[e].x,t[e].y);this.ctx.restore()}},setAngle:function(t){this.angle=t},updateCanvas:function(){this.canvas.width!=this.rect.size.width%26%26(this.canvas.width=this.rect.size.width),this.canvas.height!=this.rect.size.height%26%26(this.canvas.height=this.rect.size.height),this.canvas.style.left=GameGlobals.kickass.scrollPos.x+(this.rect.pos.x-this.rect.size.width/2)+%22px%22,this.canvas.style.top=GameGlobals.kickass.scrollPos.y+(this.rect.pos.y-this.rect.size.height/2)+%22px%22},drawLine:function(t,e,s,i){this.ctx.save(),this.ctx.translate(this.rect.size.width/2,this.rect.size.height/2),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(s,i),this.ctx.closePath(),this.ctx.stroke(),this.ctx.restore()},drawCircle:function(t,e){e=e||{x:0,y:0},this.ctx.save(),this.ctx.translate(this.rect.size.width/2,this.rect.size.height/2),e%26%26this.ctx.translate(e.x,e.y),this.ctx.beginPath(),this.ctx.arc(0,0,t,0,2*Math.PI,!0),this.ctx.fill(),this.ctx.closePath(),this.ctx.restore()},drawRect:function(t,e,s,i){this.ctx.save(),this.ctx.translate(this.rect.size.width/2,this.rect.size.height/2),this.ctx.translate(t,e),this.ctx.fillRect(t,e,s,i),this.ctx.restore(),this.ctx.fill()},drawImageFull:function(t){this.ctx.drawImage(t,0,0,this.rect.size.width,this.rect.size.height)},drawImage:function(t,e,s){this.ctx.save(),this.ctx.translate(this.rect.size.width/2+e,this.rect.size.height/2+s),this.ctx.rotate(this.angle),this.ctx.drawImage(t,0,-11),this.ctx.restore()},setFillColor:function(t){this.ctx.fillStyle=t},setStrokeColor:function(t){this.ctx.strokeStyle=t},setLineWidth:function(t){this.ctx.lineWidth=t},fillPath:function(){this.ctx.fill()},strokePath:function(){this.ctx.stroke()},clear:function(){this.ctx.clearRect(0,0,this.rect.size.width,this.rect.size.height)},destroy:function(){GameGlobals.kickass.unregisterElement(this.canvas),this.canvas.parentNode.removeChild(this.canvas)}}),Sheet=new%20Class({initialize:function(t){this.rect=t,this.drawer=new%20SheetCanvas(t)},clear:function(){this.drawer.clear()},setPosition:function(t){this.rect.pos=t.cp(),this.drawer.rect=this.rect,this.drawer.updateCanvas()},setAngle:function(t){this.drawer.setAngle(t)},drawPlayer:function(t){this.drawer.setFillColor(%22white%22),this.drawer.setStrokeColor(%22black%22),this.drawer.setLineWidth(1.5),this.drawer.tracePoly(t),this.drawer.fillPath(),this.drawer.tracePoly(t),this.drawer.strokePath()},drawBrokenPlayer:function(t,e){this.drawer.setStrokeColor(%22black%22),this.drawer.setLineWidth(1.5);for(var%20s,i=1,n=t[0];s=t[i];i++,n=s){var%20a=e[i-1];this.drawer.drawLine(n.x+a.pos.x,n.x+a.pos.y,s.x+a.pos.x,s.y+a.pos.y)}},drawFlames:function(t,e){this.drawer.setLineWidth(1.5),this.drawer.setFillColor(%22red%22),this.drawer.tracePoly(t.r),this.drawer.fillPath(),this.drawer.setFillColor(%22yellow%22),this.drawer.tracePoly(t.y),this.drawer.fillPath()},drawBullet:function(){this.drawer.setFillColor(GameGlobals.bulletColor),this.drawer.drawCircle(2.5)},drawExplosion:function(t){for(var%20e,s=0;e=t[s];s++)this.drawer.setFillColor(e.color),this.drawer.drawRect(e.pos.x,e.pos.y,3,3)},drawFace:function(t){this.drawer.drawImageFull(t)},drawLaser:function(t,e){this.clear(),this.setPosition(t),this.drawer.setAngle(e.angle()),this.drawer.drawImage(GameGlobals.laserImage,0,0)},transformToSheetCoordinates:function(t){var%20e=t.cp().sub(new%20Vector(this.rect.size.width/2,this.rect.size.height/2));return%20e},destroy:function(){this.drawer.destroy()}}),namespace=getGlobalNamespace(),initKickAss=function(){if(namespace.KICKASSGAME)namespace.KICKASSGAME.addPlayer();else%20if(namespace.KICKASS_SITE_KEY){var%20t=new%20MySite(namespace.KICKASS_SITE_KEY);t.load(function(e){namespace.KICKASSGAME=GameGlobals.kickass=new%20KickAss({mySite:e%3Ft:!1}),namespace.KICKASSGAME.begin()})}else%20namespace.KICKASSGAME=GameGlobals.kickass=new%20KickAss,namespace.KICKASSGAME.begin()};namespace.LAZYLOAD_KICKASS%3Fwindow.startBrowserBlaster=initKickAss:initKickAss()})(%22undefined%22!=typeof%20exports%3Fexports:window)},hasJQuery=$%26%26$.fn%26%26parseFloat($.fn.jquery)%3E=1.7;if(hasJQuery)loadBookmarklet($);else{var%20s=document.createElement(%22script%22);s.src=%22//ajax.googleapis.com/ajax/libs/jquery/1/jquery.js%22,s.onload=s.onreadystatechange=function(){var%20t=this.readyState;t%26%26%22loaded%22!==t%26%26%22complete%22!==t||loadBookmarklet(jQuery.noConflict())}}document.getElementsByTagName(%22head%22)[0].appendChild(s)}(window.jQuery);
